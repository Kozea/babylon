{% extends "layout.html" %}

{% macro macro_player(player)-%}
<figure>
    <img src={{ player.gravatar_url }}>
    <figcaption>
        <a href="{{ url_for('profile', id_player=player.id_user) }}">{{ player.full_name }}</a>
    </figcaption>
</figure>
{%- endmacro %}

{% macro macro_match(match)-%}
<article>
    <h2>
        <time datetime ="{{ match.date }}">{{ match.date.strftime("%Y-%m-%d %H:%M") }}</time>
    </h2>
    <section>
        <h3>{{ match.score_team_1 }}</h3>
        {{ macro_player(match.team_1_player_1) }}
        {% if match.team_1_player_2 %}
          {{ macro_player(match.team_1_player_2)}}
        {% endif %}
    </section>
    <section>
        <h3>{{ match.score_team_2 }}</h3>
        {{ macro_player(match.team_2_player_1) }}
        {% if match.team_2_player_2 %}
          {{ macro_player(match.team_2_player_2)}}
        {% endif %}
    </section>
</article>
{%- endmacro %}


{% block main %}
  <article>
    <h2>{{ user.full_name }}</h2>

    <img src="{{ user.gravatar_url }}">

    {% if user.number_of_match %}
    
    <section>
      <dl>
        <dt>Elo :</dt> 
        <dd>{{user.ranking}}</dd>
        <dt>Victories :</dt> 
        <dd>{{user.nb_victories}}</dd>
        <dt>Defeats :</dt> 
        <dd>{{user.nb_defeats}}</dd>
      </dl>
      
        <figure>
          <figcaption>Ratio :{{100*(user.nb_victories/user.number_of_match)| round(2)}}</figcaption>
          <img src="{{ url_for('svg_victory', id_player=user.id_user) }}"></img>
        </figure>
      </dl>
    </section>
    
    <section>
      <p>
        Best Teammate(s) : 
          {% for user in best_teammate %}
            <a href="{{ url_for('profile', id_player=user.id_user) }}">{{user.full_name}}</a>
          {% else %}
            No best Teammate.
          {% endfor %}
          ({{best_teammate_coeff}} team victories)
        </p>

        <p>
          Worst Teammate(s) : 
          {% for user in worst_teammate %}
            <a href="{{ url_for('profile', id_player=user.id_user) }}">{{user.full_name}}</a>
          {% else %}
            No Worst Teammate.
          {% endfor %}
          ({{worst_teammate_coeff}} team defeat(s)) 
        </p>
        
        <p>
          Nemesis :
          {% for user in nemesis %}
            <a href="{{ url_for('profile', id_player=user.id_user) }}">{{user.full_name}}</a>
          {% else %}
            No nemesis.
          {% endfor %}
          ({{nemesis_coeff}} defeat(s))) 
        </p>
        
      </section>

      <section>
        <h1>Matchs played</h1>
        {% for match in matchs %}
          {{ macro_match(match) }}
        {% else %}
          <p>There is no match yet!</p>  
        {% endfor %}
      </section>
    {% endif %}
    
  </article>
{% endblock main %}
